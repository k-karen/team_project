<%= turbo_stream_from @room %>

<!-- ルームアクション -->
<div class="d-flex flex-column" style="height: calc(100svh - 65px)">
  <div id="room-actions" class="mb-3 text-right position-relative">
    <%= turbo_frame_tag "room" do %>
      <%= link_to 'Edit', edit_room_path(@room), class: "btn btn-outline-primary btn-sm" %>
      <%= link_to root_path, "data-turbo-frame": "_top" do %>
        <button class="btn btn-outline-secondary btn-sm">
          <i class="bi bi-arrow-left"></i>
          Back
        </button>
      <% end %>
      <%= button_to "Destroy this room", @room, method: :delete, class: "btn btn-outline-danger btn-sm", data: { confirm: "本当に削除しますか？", turbo: false } %>

      <!-- 保持期間表示、絶対位置指定でボタン群の右上に配置 -->
      <div style="position: absolute; bottom: 0; right: 0; margin-right: 20px;">
        <% if @room.retention_minutes.present? %>
          <% hours = @room.retention_minutes / 60 %>
          <% minutes = @room.retention_minutes % 60 %>
          <span class="badge bg-secondary text-white">
            Message Expiration Time: 
            <span class="expiration-time"><%= sprintf('%02d:%02d', hours, minutes) %></span>
        <% else %>
          <span class="badge bg-secondary text-white">Message Expiration Time: -</span>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- メッセージリスト -->
  <div id="messages" class="border rounded messages-container flex-grow-1">
    <%= render @messages %>
  </div>


  <!-- 新規メッセージ入力 -->
  <%= turbo_frame_tag dom_id(Message.new), src: new_room_message_path(@room), target: "_top" %>
</div>

<style>
.message-<%= current_user.id %> {
  background-color: hwb(120deg 30.02% 25.47%);
  border-radius: 7.5px;
  margin-bottom: 8px;
  padding: 6px 12px;
  max-width: 80%;
  word-wrap: break-word;
  float: right;
  clear: both;
}

.message_box:not(.message-<%= current_user.id %>) {
  background-color: #ffffff;
  border-radius: 7.5px;
  margin-bottom: 8px;
  padding: 6px 12px;
  max-width: 80%;
  float: left;
  clear: both;
  word-wrap: break-word;
}
</style>
